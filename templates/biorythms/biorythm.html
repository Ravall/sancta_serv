{% extends 'biorythms/layout.html' %}
{% load static %}
{% load sancta_date %}
{% load bio_dayinfo %}

{% block content %}
<div id='title'>
    <h1> <a href='{{ link_pref }}'>&larr;</a>
      Биоритмы на {{ current_date|snct_dateformat:"[M1] [iY]" }}
    <a href='{{ link_next }}'>&rarr;</a> </h1>
    <h2> Дата рождения: {{ birthday|snct_dateformat:"[d].[m].[y]" }} </h2>
</div>

<div id='biorythms_chart' style='height:300px;'></div>


<div id='content'>
<div id='todayinfo'>
    <h2>Сегодня:
        <a href='#'>{{ today_date| snct_dateformat:"[d] [M2] [Y]"}}</a>
    </h2>
    {% if today_date in critical_days %}
      <div>
      <b>{{ today_info|critical_type_info }}:</b>
      {{ today_info|period_info  }}
      </div>
    {% endif %}
    <div>
        физический биоритм: {{ today_info|biorithm:23|safe }}<br/>
        эмоциональный биоритм: {{ today_info|biorithm:28|safe}}<br/>
        умственный биоритм: {{ today_info|biorithm:33|safe}}<br/>
    </div>
</div>
<div id='dates_in_month'>

  <h2>Важные дни {{ current_date|snct_dateformat:"[M2] [iY]" }}</h2>
  {% for day,info in critical_days.items %}
      {% if  info.is_great_critical_day %}
          <h3>{{ day }}</h3>
          <h3><b>{{ info|critical_type_info }}</b></h3>
      {% elif info.is_critical %}
          <h3>{{ day }}</h3>
          <p><b>{{ info|critical_type_info }}</b>: {{ info|period_info }}</p>
      {% endif %}
  {% endfor %}

</div>
</div>

{% endblock %}

{% block block_js %}
<script src="{% static "js/raphael-min.js" %}"></script>
<script src="{% static "js/morris-0.4.3.min.js" %}"></script>
<script type="text/javascript">
    new Morris.Line({
  element: 'biorythms_chart',
  {% autoescape off %}
      data: {{ data }},
  {% endautoescape %}
  dateFormat: function (x) {
      function addZero(i) {
          return (i < 10)? "0" + i: i;
      }
      var day = new Date(x);
      return (
          addZero(day.getDate()) + '.' +
          addZero(day.getMonth()+1) + '.' +
          day.getFullYear()
      );
  },
  xLabelFormat: function (x) {
      function addZero(i) {
          return (i < 10)? "0" + i: i;
      }
      var day = new Date(x);
      return addZero(day.getDate())+'.'+addZero(day.getMonth()+1);
  },

  xkey: 'day',
  ykeys: ['fiz', 'emo', 'smart'],
  labels: ['физический', 'эмоциональный', 'интеллектуальный'],
  hideHover: 'auto',
  {% if today_date|snct_dateformat:"[m].[y]" == current_date|snct_dateformat:"[m].[y]" %}
  events: ['{{ today_date|snct_dateformat:"[Y]-[mm]-[dd]" }}'],
  {% endif %}
  pointSize:2,
  lineColors: ['#e67869','#3b9647', '#193020'],
});

</script>
{% endblock %}